---
title: "Analysis - Pedro"
author: "Hopin Lee"
date: "26/02/2019"
output: html_document
---

```{r}

#read data
library(readr)
ped_data <- read_csv("ped_data.csv")

#load packages
library('dplyr')
library('tidyr')
library('gapminder')
library('ggplot2')
library ('ggalt')
library('forcats')
library('R.utils') 
library('png')
library('grid')
library('ggpubr')
library('scales') 
library('bbplot')

#Remove data >2018 
#assign data <2018 as pedro_data
pedro.data = subset(ped_data, year !="2018") 

#assign data with clinical trials only as pedro_data_rct
pedro.data.rct = subset(pedro.data, method !="systematic review")

#assign data with systematic reviews only as pedro_data_sr
pedro.data.sr = subset(pedro.data, method !="clinical trial")

# Note: Aidan - you could use the dplyr functions to do the above to keep the analysis tidy. No biggie though... 
```


# Trends over time
```{r}
tr <- pedro.data %>% group_by(year) %>% count(method)  # grouping the data by year, then counting the number of trials and reviews. Then assigning that dataframe to "tr". 

# Now you want to plot "n" by "year" 
tr.trend <- tr %>% ggplot(aes(year, n, colour=method, shape=method)) +
          geom_point(aes(colour = method)) +
          geom_smooth(aes(color = method)) +
          scale_x_continuous(name = "Year",
                             limits = c(1950,2020), 
                             breaks = seq(1950,2020,5)) +
          scale_y_continuous(name = "Count",
                             breaks = seq(0,150,25)) +
          scale_colour_discrete(name  ="Study type",
                                breaks=c("clinical trial", "systematic review"),
                                labels=c("Clinical Trials", "Systematic Reviews")) +
          scale_shape_discrete(name  ="Study type",
                               breaks=c("clinical trial", "systematic review"),
                               labels=c("Clinical Trials", "Systematic Reviews"))

tr.trend
```


# Trends in mean PEDro score over time
```{r}

# grouping the data by year, then calculating the mean PEDro score, then assigning that dataframe to "tr_score".
tr_score <- pedro.data.rct %>% group_by(year) %>% summarise(mean.score = mean(score)) 

# Plot "mean.score" by "year" 
tr.score.trend <- tr_score %>% ggplot(aes(year, mean.score, colour=mean.score)) +
  geom_point(aes(colour = mean.score)) +
  geom_smooth(aes(color = mean.score)) +
  scale_x_continuous(name = "Year",
                     limits = c(1950,2020), 
                     breaks = seq(1950,2020,5)) +
  scale_y_continuous(name = "Meam PEDro Score",
                     breaks = seq(0,10)) 
#visualise plot
tr.score.trend
```

# Trends in publications per therapy (acupuncture)  
## Note: this code will be repeated for all therapies... results to be displayed in appendix
```{r}

# grouping the data by year, then sum the number studies for acupuncture, then assign to "tr.acu"
tr.acu <- pedro.data %>% group_by(year) %>% summarise(total.acu = sum(rx_acu)) 

# Plot "total.acu" by "year" 
tr.acu.trend <- tr.acu %>% ggplot(aes(year, total.acu, colour=total.acu)) +
  geom_point(aes(colour = total.acu)) +
  geom_smooth(aes(color = total.acu)) +
  scale_x_continuous(name = "Year",
                     limits = c(1950,2020), 
                     breaks = seq(1950,2020,5)) +
  scale_y_continuous(name = "Count",
                     breaks = seq(0,80,5)) 
#visualise plot
tr.acu.trend
```

